<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highland Fresh - Dairy Supplier Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="admin-dashboard.html">
                <img src="../images/highland_fresh_logo.jpg" alt="Highland Fresh Logo" class="navbar-logo">
                Highland Fresh - Suppliers
            </a>
            <div class="navbar-nav ms-auto d-flex align-items-center">
                <span class="navbar-text me-3" id="userWelcome">
                    <i class="bi bi-person-circle me-1"></i>Welcome, Admin
                </span>
                <a href="admin-dashboard.html" class="btn btn-outline-secondary btn-sm me-2">
                    <i class="bi bi-grid me-1"></i>Dashboard
                </a>
                <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </button>
            </div>
        </div>
    </nav>
    <div class="container mt-4 mb-5">
        <div class="row">
            <div class="col-12">
                
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="dashboard-title mb-2">
                            <i class="bi bi-truck me-2"></i>Dairy Supplier Management
                        </h1>
                        <p class="dashboard-subtitle mb-0">
                            <i class="bi bi-geo-alt me-1"></i>
                            NMFDC Cooperatives & Highland Fresh Dairy Supply Chain
                        </p>
                    </div>
                    <button class="btn btn-feature" data-bs-toggle="modal" data-bs-target="#supplierModal" onclick="openAddSupplierModal()">
                        <i class="bi bi-plus-circle me-1"></i>Add Supplier
                    </button>
                </div>
            </div>
        </div>

        <div id="alertContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;"></div>

        <div id="loadingSpinner" class="text-center d-none">
            <div class="spinner-border" style="color: var(--hf-primary);" role="status">
                <span class="visually-hidden">Loading Highland Fresh suppliers...</span>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card main-card">
                    <div class="card-body">
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="color: var(--text-primary); font-weight: 600;">Supplier Name</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Type</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Contact Person</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Phone</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Daily Capacity (L)</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Location</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">NMFDC Member</th>
                                            <th style="color: var(--text-primary); font-weight: 600;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="suppliersTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="emptyState" class="text-center py-5 d-none">
                            <div class="feature-icon mx-auto mb-3" style="width: 64px; height: 64px; font-size: 1.5rem;">
                                <i class="bi bi-truck"></i>
                            </div>
                            <h5 class="text-muted mt-3">No Highland Fresh suppliers found</h5>
                            <p class="text-muted">Start by adding your first dairy supplier to manage milk deliveries and cooperative relationships.</p>
                            <button class="btn btn-feature" data-bs-toggle="modal" data-bs-target="#supplierModal" onclick="openAddSupplierModal()">
                                <i class="bi bi-plus-circle me-1"></i>Add First Dairy Supplier
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="supplierModal" tabindex="-1" aria-labelledby="supplierModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                    <h5 class="modal-title" id="supplierModalLabel" style="color: var(--text-primary); font-weight: 600;">
                        <i class="bi bi-plus-circle me-2"></i>Add Highland Fresh Dairy Supplier
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierForm" novalidate>
                        <input type="hidden" id="supplierId" name="supplierId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="supplierName" class="form-label">Supplier Name *</label>
                                    <input type="text" class="form-control" id="supplierName" name="supplierName" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contactPerson" class="form-label">Contact Person *</label>
                                    <input type="text" class="form-control" id="contactPerson" name="contactPerson" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="supplierEmail" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="supplierEmail" name="supplierEmail" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phoneNumber" class="form-label">Phone *</label>
                                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="supplierAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="supplierAddress" name="supplierAddress" rows="2"></textarea>
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="supplierCountry" class="form-label">Country</label>
                                    <select class="form-select" id="supplierCountry" name="supplierCountry">
                                        <option value="">Select country...</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="supplierCity" class="form-label">City</label>
                                    <select class="form-select" id="supplierCity" name="supplierCity" disabled>
                                        <option value="">Select a city...</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="postalCode" class="form-label">Zip Code</label>
                                    <input type="text" class="form-control" id="postalCode" name="postalCode">
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" style="border-color: var(--border-color);">
                        <h6 style="color: var(--hf-primary); font-weight: 600;" class="mb-3">
                            <i class="bi bi-droplet me-2"></i>Dairy Supplier Information
                        </h6>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="supplierType" class="form-label">Supplier Type *</label>
                                    <select class="form-select" id="supplierType" name="supplierType" required>
                                        <option value="">Select Type</option>
                                        <option value="Dairy Cooperative">Dairy Cooperative</option>
                                        <option value="Individual Farm">Individual Farm</option>
                                        <option value="Packaging Supplier">Packaging Supplier</option>
                                        <option value="Ingredient Supplier">Ingredient Supplier</option>
                                        <option value="Equipment Supplier">Equipment Supplier</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="cooperativeCode" class="form-label">Cooperative Code</label>
                                    <input type="text" class="form-control" id="cooperativeCode" name="cooperativeCode" placeholder="e.g., DDC-001">
                                    <div class="invalid-feedback"></div>
                                    <div class="form-text">For dairy cooperatives only</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row dairy-fields" id="dairyFields" style="display: none;">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="dailyMilkCapacity" class="form-label">Daily Milk Capacity (Liters)</label>
                                    <input type="number" class="form-control" id="dailyMilkCapacity" name="dailyMilkCapacity" step="0.01" min="0">
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="numberOfCows" class="form-label">Number of Cows</label>
                                    <input type="number" class="form-control" id="numberOfCows" name="numberOfCows" min="0">
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="milkQualityGrade" class="form-label">Milk Quality Grade</label>
                                    <select class="form-select" id="milkQualityGrade" name="milkQualityGrade">
                                        <option value="Grade A">Grade A</option>
                                        <option value="Grade B">Grade B</option>
                                        <option value="Grade C">Grade C</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row dairy-fields" style="display: none;">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="deliverySchedule" class="form-label">Delivery Schedule</label>
                                    <select class="form-select" id="deliverySchedule" name="deliverySchedule">
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Bi-weekly">Bi-weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="On-demand">On-demand</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="establishedYear" class="form-label">Established Year</label>
                                    <input type="number" class="form-control" id="establishedYear" name="establishedYear" min="1950" max="2025">
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row dairy-fields" style="display: none;">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="collectionStationAddress" class="form-label">Collection Station Address</label>
                                    <textarea class="form-control" id="collectionStationAddress" name="collectionStationAddress" rows="2" placeholder="Address of milk collection/chilling station..."></textarea>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row dairy-fields" style="display: none;">
                            <div class="col-md-6">
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="isNmfdcMember" name="isNmfdcMember">
                                    <label class="form-check-label" for="isNmfdcMember">
                                        NMFDC Member Cooperative
                                    </label>
                                    <div class="form-text">Check if this is a Northern Mindanao Federation of Dairy Cooperatives member</div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4" style="border-color: var(--border-color);">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="taxId" class="form-label">Tax ID</label>
                                    <input type="text" class="form-control" id="taxId" name="taxId">
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="paymentTerms" class="form-label">Payment Terms</label>
                                    <select class="form-select" id="paymentTerms" name="paymentTerms">
                                        <option value="">Select Payment Terms</option>
                                        <option value="Net 30">Net 30</option>
                                        <option value="Net 15">Net 15</option>
                                        <option value="COD">Cash on Delivery</option>
                                        <option value="Prepaid">Prepaid</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3" id="statusField" style="display: none;">
                                    <label for="status" class="form-label">Status</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Additional notes about this supplier..."></textarea>
                            <div class="invalid-feedback"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-feature" id="saveSupplierBtn" onclick="saveSupplier()">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="saveSpinner"></span>
                        Save Supplier
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                    <h5 class="modal-title" id="deleteConfirmModalLabel" style="color: var(--text-primary); font-weight: 600;">
                        <i class="bi bi-exclamation-triangle me-2" style="color: var(--danger-color);"></i>Confirm Delete Highland Fresh Supplier
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="color: var(--text-primary);">Are you sure you want to delete this Highland Fresh dairy supplier?</p>
                    <div class="alert alert-warning" style="background-color: #fff8dc; border: 1px solid #ffeaa7; color: #d63031;">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> This action cannot be undone and will affect your dairy supply chain.
                    </div>
                    <p><strong style="color: var(--text-primary);">Supplier:</strong> <span id="deleteSupplierName" style="color: var(--text-secondary);"></span></p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteSupplier()">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="deleteSpinner"></span>
                        Delete Supplier
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../js/api-handler.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/suppliers/SupplierAPI.js"></script>
    <script src="../js/suppliers/SupplierRenderer.js"></script>
    <script src="../js/suppliers/SupplierAnimations.js"></script>
    <script src="../js/suppliers/SupplierModal.js"></script>
    <script src="../js/suppliers/SupplierManager.js"></script>
    <script>
        // Initialize the supplier management system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing supplier management...');
            try {
                window.supplierManager = new SupplierManager();
                supplierManager.init();
                console.log('Supplier manager initialized successfully');
                
                // Initialize dairy supplier type functionality
                initializeDairySupplierFields();
                
            } catch (error) {
                console.error('Failed to initialize supplier manager:', error);
                // Show error to user
                if (document.getElementById('alertContainer')) {
                    const alertHtml = `
                        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                            <div class="toast-header bg-danger text-white">
                                <strong class="me-auto">Initialization Error</strong>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                            </div>
                            <div class="toast-body">
                                Failed to initialize supplier management. Please refresh the page.
                            </div>
                        </div>
                    `;
                    document.getElementById('alertContainer').innerHTML = alertHtml;
                    const toast = new bootstrap.Toast(document.querySelector('.toast'));
                    toast.show();
                }
            }
        });
        
        // Initialize dairy supplier type functionality
        function initializeDairySupplierFields() {
            const supplierTypeSelect = document.getElementById('supplierType');
            const dairyFields = document.querySelectorAll('.dairy-fields');
            
            if (supplierTypeSelect) {
                supplierTypeSelect.addEventListener('change', function() {
                    const isDairySupplier = this.value === 'Dairy Cooperative' || this.value === 'Individual Farm';
                    
                    dairyFields.forEach(fieldGroup => {
                        if (isDairySupplier) {
                            fieldGroup.style.display = 'flex';
                        } else {
                            fieldGroup.style.display = 'none';
                            // Clear dairy-specific field values when hidden
                            const inputs = fieldGroup.querySelectorAll('input, select, textarea');
                            inputs.forEach(input => {
                                if (input.type === 'checkbox') {
                                    input.checked = false;
                                } else {
                                    input.value = '';
                                }
                            });
                        }
                    });
                    
                    // Handle cooperative code field visibility
                    const cooperativeCodeGroup = document.getElementById('cooperativeCode').closest('.mb-3');
                    if (this.value === 'Dairy Cooperative') {
                        cooperativeCodeGroup.style.display = 'block';
                        document.getElementById('cooperativeCode').required = true;
                    } else {
                        cooperativeCodeGroup.style.display = 'none';
                        document.getElementById('cooperativeCode').required = false;
                        document.getElementById('cooperativeCode').value = '';
                    }
                });
                
                // Trigger change event to set initial state
                supplierTypeSelect.dispatchEvent(new Event('change'));
            }
        }
        
        // Global logout function for nav
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>